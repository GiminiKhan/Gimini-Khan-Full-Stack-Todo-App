# Data Model: Web Authentication and Todo Management

## User Entity

**Fields**:
- id: UUID (Primary Key, auto-generated)
- email: String (Unique, required, validated as email format)
- name: String (Required)
- created_at: DateTime (Auto-generated timestamp)
- updated_at: DateTime (Auto-generated timestamp, updated on change)

**Relationships**:
- One-to-Many: User has many Todos

**Validation Rules**:
- Email must be unique across all users
- Email must pass standard email format validation
- Name must be 1-100 characters

**State Transitions**:
- Created → Active (default state upon account creation)

## Todo Entity

**Fields**:
- id: UUID (Primary Key, auto-generated)
- title: String (Required, 1-200 characters)
- description: Text (Optional, 0-1000 characters)
- priority: Enum (Required, values: "high", "medium", "low")
- completed: Boolean (Required, default: false)
- user_id: UUID (Foreign Key, references User.id, required)
- created_at: DateTime (Auto-generated timestamp)
- updated_at: DateTime (Auto-generated timestamp, updated on change)

**Relationships**:
- Many-to-One: Todo belongs to one User (user_id foreign key)

**Validation Rules**:
- Title must be 1-200 characters
- Priority must be one of: "high", "medium", "low"
- User_id must reference an existing User
- Completed must be boolean

**State Transitions**:
- Created → Active (default state upon creation)
- Active ↔ Completed (toggled by user)

## Session Token (Handled by Better Auth)

**Fields**:
- token: String (JWT token, auto-generated by Better Auth)
- user_id: UUID (Foreign Key, references User.id, required)
- expires_at: DateTime (Auto-generated, based on auth config)
- created_at: DateTime (Auto-generated timestamp)

**Relationships**:
- Many-to-One: Session Token belongs to one User

**Validation Rules**:
- Token must be valid JWT format
- Expires_at must be in the future
- User_id must reference an existing User

## Authentication Response Model

**Fields** (returned by authenticate_user method):
- access_token: String (JWT token with user claims)
- token_type: String (always "bearer")
- user: User object (authenticated user details)

**Token Payload Structure**:
- sub: String (subject - user ID)
- email: String (user email)
- name: String (user name)
- exp: DateTime (expiration timestamp, auto-added)

**Change Requirement**:
- Replace hardcoded fake token `f'fake-token-{user.id}'` with real JWT token
- Use `create_access_token` function from `core.security` module
- Include proper user identification in token payload

## API Contract Definitions

### GET /api/todos
- **Response**: Array of Todo objects (filtered by authenticated user)
- **Headers**: Authorization: Bearer {token}
- **Authentication**: Required (valid JWT token)
- **Authorization**: User can only access their own todos

### POST /api/todos
- **Request Body**: {title: string, description?: string, priority: "high"|"medium"|"low"}
- **Response**: Created Todo object
- **Headers**: Authorization: Bearer {token}
- **Authentication**: Required (valid JWT token)
- **Validation**: Request body must conform to Todo entity validation rules

### PATCH /api/todos/{id}
- **Request Body**: {title?: string, description?: string, priority?: "high"|"medium"|"low", completed?: boolean}
- **Response**: Updated Todo object
- **Headers**: Authorization: Bearer {token}
- **Authentication**: Required (valid JWT token)
- **Authorization**: User can only update their own todos
- **Validation**: Request body fields must conform to Todo entity validation rules

### DELETE /api/todos/{id}
- **Response**: Empty body (204 No Content)
- **Headers**: Authorization: Bearer {token}
- **Authentication**: Required (valid JWT token)
- **Authorization**: User can only delete their own todos