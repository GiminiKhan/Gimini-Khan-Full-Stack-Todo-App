(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{9653:function(e,t,r){Promise.resolve().then(r.bind(r,6889))},6889:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return DashboardPage}});var s=r(7437),a=r(9080),o=r(2265),n=r(4033),i=r(4829);let l=i.Z.create({baseURL:"http://127.0.0.1:8000/api/v1",timeout:1e4,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{try{let t=localStorage.getItem("better-auth.session_token");t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))}catch(e){console.error("Error getting Better Auth token:",e)}return e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("better-auth.session_token"),window.location.href="/login"),Promise.reject(e)});let apiGet=async(e,t)=>await l.get(e,t),apiPost=async(e,t,r)=>await l.post(e,t,r),api_apiPut=async(e,t,r)=>await l.put(e,t,r),apiDelete=async(e,t)=>await l.delete(e,t);var c=r(6885);let getTasks=async()=>{try{let e=(0,c.hP)();console.log("Access token for tasks API:",e);let t=localStorage.getItem("user"),r="";if(t)try{let e=JSON.parse(t);r=e.id}catch(e){console.error("Error parsing user from localStorage:",e)}if(!r&&e)try{let t=e.split(".");if(3===t.length){let e=JSON.parse(atob(t[1]));r=e.userId||e.sub||e.user_id}}catch(e){console.error("Error decoding token to get user ID:",e)}if(console.log("User ID for tasks API:",r),!r)throw Error("User ID is required to fetch tasks");let s=await apiGet("/api/".concat(r,"/tasks"));return s.data}catch(e){throw console.error("Error fetching tasks:",e),e}},createTask=async e=>{try{let t=(0,c.hP)(),r="";if(t)try{let e=t.split(".");if(3===e.length){let t=JSON.parse(atob(e[1]));r=t.userId||t.sub||t.user_id}}catch(e){console.error("Error decoding token to get user ID:",e)}if(!r)throw Error("User ID is required to create task");let s=await apiPost("/api/".concat(r,"/tasks"),e);return s.data}catch(e){throw console.error("Error creating task:",e),e}},deleteTask=async e=>{try{let t=(0,c.hP)(),r="";if(t)try{let e=t.split(".");if(3===e.length){let t=JSON.parse(atob(e[1]));r=t.userId||t.sub||t.user_id}}catch(e){console.error("Error decoding token to get user ID:",e)}if(!r)throw Error("User ID is required to delete task");await apiDelete("/api/".concat(r,"/tasks/").concat(e))}catch(e){throw console.error("Error deleting task:",e),e}},toggleTaskCompletion=async(e,t)=>{try{let r=(0,c.hP)(),s="";if(r)try{let e=r.split(".");if(3===e.length){let t=JSON.parse(atob(e[1]));s=t.userId||t.sub||t.user_id}}catch(e){console.error("Error decoding token to get user ID:",e)}if(!s)throw Error("User ID is required to toggle task completion");let a=await api_apiPut("/api/".concat(s,"/tasks/").concat(e,"/complete?is_completed=").concat(t));return a.data}catch(e){throw console.error("Error toggling task completion:",e),e}};var d=r(3611),u=r(9598),h=r(5831),f=r(1628);let p=o.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("textarea",{className:(0,f.cn)("flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...a})});p.displayName="Textarea";var m=r(8674),g=r(2442);let v=o.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(m.fC,{ref:t,className:(0,f.cn)("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",r),...a,children:(0,s.jsx)(m.z$,{className:(0,f.cn)("grid place-content-center text-current"),children:(0,s.jsx)(g.Z,{className:"h-4 w-4"})})})});v.displayName=m.fC.displayName;var x=r(1465),y=r(446),b=r(9883),k=r(5367);function DashboardPage(){let{user:e,loading:t,logout:r}=(0,a.useAuth)(),i=(0,n.useRouter)(),{toast:l}=(0,y.pm)(),[c,f]=(0,o.useState)(!1),[m,g]=(0,o.useState)([]),[w,N]=(0,o.useState)(!0),[T,j]=(0,o.useState)(!1),[A,_]=(0,o.useState)({title:"",description:""});(0,o.useEffect)(()=>{f(!0),console.log("Current User:",e),console.log("Auth Loading:",t)},[e,t,i]),(0,o.useEffect)(()=>{e&&c?fetchTasks():t||e||console.log("No user authenticated, staying on dashboard for testing")},[e,c,t]);let fetchTasks=async()=>{try{N(!0);let e=await getTasks();g(e)}catch(e){console.error("Error fetching tasks:",e),l({title:"Error",description:"Failed to load tasks. Please try again.",variant:"destructive"})}finally{N(!1)}},handleCreateTask=async e=>{if(e.preventDefault(),A.title.trim()){j(!0);try{let e={...A,is_completed:!1},t=await createTask(e);g([t,...m]),_({title:"",description:""}),l({title:"Task Created",description:"Your task has been created successfully!"})}catch(e){console.error("Error creating task:",e),l({title:"Error",description:"Failed to create task. Please try again.",variant:"destructive"})}finally{j(!1)}}},handleToggleTask=async(e,t)=>{try{let r=await toggleTaskCompletion(e,!t);g(m.map(t=>t.id===e?r:t))}catch(e){console.error("Error toggling task:",e),l({title:"Error",description:"Failed to update task. Please try again.",variant:"destructive"})}},handleDeleteTask=async e=>{try{await deleteTask(e),g(m.filter(t=>t.id!==e)),l({title:"Task Deleted",description:"Your task has been deleted successfully!"})}catch(e){console.error("Error deleting task:",e),l({title:"Error",description:"Failed to delete task. Please try again.",variant:"destructive"})}};return t||!c?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-lg",children:"Loading..."})}):(0,s.jsx)("div",{className:"container mx-auto py-10",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"Todo Dashboard"}),(0,s.jsxs)(u.Zb,{className:"mb-8",children:[(0,s.jsx)(u.Ol,{children:(0,s.jsx)(u.ll,{children:"Add New Task"})}),(0,s.jsx)(u.aY,{children:(0,s.jsxs)("form",{onSubmit:handleCreateTask,className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{htmlFor:"title",children:"Title"}),(0,s.jsx)(h.I,{id:"title",value:A.title,onChange:e=>_({...A,title:e.target.value}),placeholder:"What needs to be done?",required:!0})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x._,{htmlFor:"description",children:"Description"}),(0,s.jsx)(p,{id:"description",value:A.description,onChange:e=>_({...A,description:e.target.value}),placeholder:"Add details (optional)"})]}),(0,s.jsx)(d.z,{type:"submit",disabled:T,className:"w-full",children:T?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"mr-2",children:"Creating..."}),(0,s.jsx)("span",{className:"animate-spin",children:"â³"})]}):(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(b.Z,{className:"mr-2 h-4 w-4"}),"Add Task"]})})]})})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold",children:"Your Tasks"}),w?(0,s.jsx)("div",{className:"text-center py-8",children:"Loading tasks..."}):0===m.length?(0,s.jsx)("div",{className:"text-center py-12",children:(0,s.jsx)("p",{className:"text-lg text-gray-500",children:"No tasks yet. Add your first task above!"})}):(0,s.jsx)("div",{className:"space-y-3",children:m.map(e=>(0,s.jsxs)(u.Zb,{className:"flex items-center justify-between p-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(v,{id:"task-".concat(e.id),checked:e.is_completed,onCheckedChange:()=>handleToggleTask(e.id,e.is_completed)}),(0,s.jsxs)("div",{children:[(0,s.jsx)(x._,{htmlFor:"task-".concat(e.id),className:"text-base ".concat(e.is_completed?"line-through text-gray-500":""),children:e.title}),e.description&&(0,s.jsx)("p",{className:"text-sm ".concat(e.is_completed?"text-gray-500":"text-gray-600"),children:e.description})]})]}),(0,s.jsx)(d.z,{variant:"ghost",size:"sm",onClick:()=>handleDeleteTask(e.id),className:"text-red-500 hover:text-red-700",children:(0,s.jsx)(k.Z,{className:"h-4 w-4"})})]},e.id))})]}),(0,s.jsx)("div",{className:"mt-8 flex justify-end",children:(0,s.jsx)(d.z,{variant:"outline",onClick:()=>{r(),i.push("/login")},children:"Logout"})})]})})}},3611:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var s=r(7437),a=r(2265),o=r(7256),n=r(6061),i=r(1628);let l=(0,n.j)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:n,asChild:c=!1,...d}=e,u=c?o.g7:"button";return(0,s.jsx)(u,{className:(0,i.cn)(l({variant:a,size:n,className:r})),ref:t,...d})});c.displayName="Button"},9598:function(e,t,r){"use strict";r.d(t,{Ol:function(){return i},SZ:function(){return c},Zb:function(){return n},aY:function(){return d},eW:function(){return u},ll:function(){return l}});var s=r(7437),a=r(2265),o=r(1628);let n=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("rounded-xl border bg-card text-card-foreground shadow",r),...a})});n.displayName="Card";let i=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex flex-col space-y-1.5 p-6",r),...a})});i.displayName="CardHeader";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("font-semibold leading-none tracking-tight",r),...a})});l.displayName="CardTitle";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",r),...a})});c.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent";let u=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)("div",{ref:t,className:(0,o.cn)("flex items-center p-6 pt-0",r),...a})});u.displayName="CardFooter"},5831:function(e,t,r){"use strict";r.d(t,{I:function(){return n}});var s=r(7437),a=r(2265),o=r(1628);let n=a.forwardRef((e,t)=>{let{className:r,type:a,...n}=e;return(0,s.jsx)("input",{type:a,className:(0,o.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",r),ref:t,...n})});n.displayName="Input"},1465:function(e,t,r){"use strict";r.d(t,{_:function(){return c}});var s=r(7437),a=r(2265),o=r(706),n=r(6061),i=r(1628);let l=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,s.jsx)(o.f,{ref:t,className:(0,i.cn)(l(),r),...a})});c.displayName=o.f.displayName},9080:function(e,t,r){"use strict";r.r(t),r.d(t,{AuthProvider:function(){return AuthProvider},useAuth:function(){return useAuth}});var s=r(7437),a=r(2265),o=r(6885);let n=(0,a.createContext)(void 0);function AuthProvider(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[l,c]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let initAuth=async()=>{try{let e=await (0,o.t0)();e&&i(e)}catch(e){console.error("Auth initialization error:",e),(0,o.TX)()}finally{c(!1)}};initAuth()},[]);let checkAuth=async()=>{try{let e=await (0,o.t0)();if(e){i(e);return}i(null)}catch(e){console.error("Auth check error:",e),i(null)}};return(0,s.jsx)(n.Provider,{value:{user:r,loading:l,login:(e,t)=>{localStorage.setItem("accessToken",t),i(e)},logout:()=>{(0,o.TX)(),i(null)},checkAuth},children:t})}function useAuth(){let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},446:function(e,t,r){"use strict";r.d(t,{pm:function(){return useToast}});var s=r(2265);let a=0;function genId(){return(a=(a+1)%Number.MAX_SAFE_INTEGER).toString()}let o=new Map,addToRemoveQueue=e=>{if(o.has(e))return;let t=setTimeout(()=>{o.delete(e),dispatch({type:"REMOVE_TOAST",toastId:e})},1e6);o.set(e,t)},reducer=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?addToRemoveQueue(r):e.toasts.forEach(e=>{addToRemoveQueue(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},n=[],i={toasts:[]};function dispatch(e){i=reducer(i,e),n.forEach(e=>{e(i)})}function toast(e){let{...t}=e,r=genId(),dismiss=()=>dispatch({type:"DISMISS_TOAST",toastId:r});return dispatch({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||dismiss()}}}),{id:r,dismiss,update:e=>dispatch({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function useToast(){let[e,t]=s.useState(i);return s.useEffect(()=>(n.push(t),()=>{let e=n.indexOf(t);e>-1&&n.splice(e,1)}),[e]),{...e,toast,dismiss:e=>dispatch({type:"DISMISS_TOAST",toastId:e})}}},1628:function(e,t,r){"use strict";r.d(t,{cn:function(){return cn}});var s=r(7042),a=r(4769);function cn(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,s.W)(t))}},6885:function(e,t,r){"use strict";r.d(t,{t0:function(){return checkAuthStatus},hP:function(){return getAccessToken},pH:function(){return loginUser},TX:function(){return logoutUser},a$:function(){return registerUser},j1:function(){return saveAccessToken}});var s=r(6989),a=r(2601);let o=(0,s.X)({baseURL:a.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:8000",fetchOptions:{credentials:"include"}}),{signIn:n,signOut:i,useSession:l}=o,registerUser=async e=>{console.log("Attempting registration with data:",e);try{var t,r,s,a,o,i;let l=await n.email({email:e.email,password:e.password,callbackURL:"/dashboard"});return console.log("Registration response received:",l),{id:(null===(r=l.data)||void 0===r?void 0:null===(t=r.user)||void 0===t?void 0:t.id)||"",email:(null===(a=l.data)||void 0===a?void 0:null===(s=a.user)||void 0===s?void 0:s.email)||"",full_name:null===(i=l.data)||void 0===i?void 0:null===(o=i.user)||void 0===o?void 0:o.name,is_active:!0}}catch(e){throw console.error("Better Auth registration error:",e),e}},loginUser=async e=>{console.log("Attempting login with credentials:",e);try{var t;let r=await n.email({email:e.email,password:e.password,callbackURL:"/dashboard"});return console.log("Login response received:",r),{access_token:(null===(t=r.data)||void 0===t?void 0:t.token)||"better_auth_session",token_type:"bearer"}}catch(e){throw console.error("Better Auth login error:",e),e}},checkAuthStatus=async()=>{console.log("Checking auth status...");try{let e=await fetch("/api/auth/session");if(console.log("Auth status response:",e.status),e.ok){let t=await e.json();if(console.log("Session data:",t),t.user)return{id:t.user.id,email:t.user.email,full_name:t.user.name||t.user.email.split("@")[0],is_active:!0}}return null}catch(e){return console.error("Better Auth status check error:",e),null}},logoutUser=async()=>{try{await i()}catch(e){throw console.error("Better Auth logout error:",e),e}},saveAccessToken=e=>{localStorage.setItem("better-auth.session_token",e)},getAccessToken=()=>localStorage.getItem("better-auth.session_token")}},function(e){e.O(0,[996,85,805,971,472,744],function(){return e(e.s=9653)}),_N_E=e.O()}]);